#!/usr/bin/env python
"""
 *****************************COPYRIGHT******************************
 (C) Crown copyright Met Office. All rights reserved.
 For further details please refer to the file COPYRIGHT.txt
 which you should have received as part of this distribution.
 *****************************COPYRIGHT******************************

 CODE OWNER
   Stephen Haddad

 NAME
   oasisBuild.py

 DESCRIPTION
    Buids the Oasis3-mct library and tutorials and creates associated
    environment modules.

 ENVIRONMENT VARIABLES

   SYSTEM_NAME
   BUILD_OASIS
   OASIS3_MCT
   OASIS_PLATFORM_NAME
   OASIS_REPO_URL
   OASIS_REV_NO
   OASIS_OUTPUT_DIR (if building)
   OASIS_PREBUILD_DIR (if copying prebuild)
   VERBOSE (optional)
   DEPLOY_AS_MODULE (optional)
   MODULE_INSTALL_PATH (optional)
   OASIS_MODULE_VERSION (optional)
   OASIS_BUILD_TUTORIAL (optional)
   OASIS_MAKE_REPO_URL (optional)
   OASIS_MAKE_REV_NO (optional)
   OASIS_TUTORIAL_REPO_URL (optional)
   OASIS_TUTORIAL_REV_NO (optional)
"""

import os
import sys

import common
import OasisBuildSystem

def main():
    """
    Main function for script.
    """
    system_name = os.environ['SYSTEM_NAME']
    try:
        do_module = os.environ['USE_OASIS'] == 'true'
    except KeyError:
        common.formattedWrite(sys.stdout,
                              'USE_OASIS environment variable not found, '
                              'using default value of False.')
        do_module = False
        do_build = False

    if do_module:
        try:
            do_build = os.environ['BUILD_OASIS'] == 'true'
        except KeyError:
            common.formattedWrite(sys.stdout,
                                  'BUILD_OASIS environment variable not '
                                  'found, using default value of False.')
        do_build = False



    # if not using and not building oasis, exit immediately
    if not do_module and not do_build:
        common.formattedWrite(sys.stdout,
                              'oasis will not be built and module '
                              'will not be created.')
        return

    build_system = OasisBuildSystem.create_build_system(system_name,
                                                        os.environ)
    sys.stdout.write(str(build_system) + '\n')
    build_system.run_build()

if __name__ == '__main__':
    main()
